# M√ìDULO DE AUTENTICA√á√ÉO - AUTH_MODULE

## üìå Vis√£o Geral

Sistema de autentica√ß√£o baseado em credenciais (email/senha) usando Laravel Sanctum para emiss√£o de tokens de API. Este m√≥dulo fornece endpoints REST para registro, login e recupera√ß√£o de senha.

## üîó Links R√°pidos
- Controller: `app/Modules/Auth/Controllers/CredentialsAuthController.php`
- Rotas: `routes/api/v1/auth.php`
- Modelo User: `app/Modules/Shared/Models/User.php`
- Requests: `app/Modules/Auth/Requests/`
- Database schema: `docs/database-schema.md`

## üß± Componentes Principais

### Arquitetura
```
‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îî‚îÄ‚îÄ CredentialsAuthController.php    # Endpoints de autentica√ß√£o
‚îú‚îÄ‚îÄ Requests/
‚îÇ   ‚îú‚îÄ‚îÄ LoginRequest.php                 # Valida√ß√£o de login
‚îÇ   ‚îú‚îÄ‚îÄ RegisterRequest.php              # Valida√ß√£o de registro
‚îÇ   ‚îú‚îÄ‚îÄ ForgotPasswordRequest.php        # Valida√ß√£o de forgot password
‚îÇ   ‚îî‚îÄ‚îÄ ResetPasswordRequest.php         # Valida√ß√£o de reset password
‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îî‚îÄ‚îÄ User.php                         # Modelo de usu√°rio (Shared)
‚îî‚îÄ‚îÄ Routes/
    ‚îî‚îÄ‚îÄ api/v1/auth.php                  # Rotas de autentica√ß√£o
```

### Stack Tecnol√≥gico
- **Framework:** Laravel 10
- **Autentica√ß√£o:** Laravel Sanctum (tokens stateless)
- **Valida√ß√£o:** FormRequest (PSR-7)
- **Password Reset:** Laravel Password Broker
- **Rate Limiting:** Custom throttle middleware
- **Database:** PostgreSQL 15

## 1. Estrutura do Banco de Dados

### Tabela `users`

```sql
CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    email_verified_at TIMESTAMP NULL,
    password VARCHAR(255) NOT NULL,
    remember_token VARCHAR(100) NULL,

    -- Campos opcionais de integra√ß√£o GoHighLevel
    ghl_location_id VARCHAR(255) NULL UNIQUE,
    ghl_business_id VARCHAR(255) NULL,
    ghl_phone VARCHAR(255) NULL,
    ghl_website VARCHAR(255) NULL,
    ghl_address TEXT NULL,
    ghl_city VARCHAR(255) NULL,
    ghl_state VARCHAR(255) NULL,
    ghl_postal_code VARCHAR(255) NULL,
    ghl_country VARCHAR(255) NULL,
    ghl_description TEXT NULL,
    ghl_last_sync_at TIMESTAMP NULL,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_users_email (email),
    INDEX idx_users_ghl_location (ghl_location_id)
);
```

### Tabela `password_reset_tokens`

```sql
CREATE TABLE password_reset_tokens (
    email VARCHAR(255) PRIMARY KEY,
    token VARCHAR(255) NOT NULL,
    created_at TIMESTAMP NULL,

    INDEX idx_password_reset_email (email)
);
```

### Tabela `personal_access_tokens` (Sanctum)

```sql
CREATE TABLE personal_access_tokens (
    id BIGSERIAL PRIMARY KEY,
    tokenable_type VARCHAR(255) NOT NULL,
    tokenable_id BIGINT NOT NULL,
    name VARCHAR(255) NOT NULL,
    token VARCHAR(64) NOT NULL UNIQUE,
    abilities TEXT NULL,
    last_used_at TIMESTAMP NULL,
    expires_at TIMESTAMP NULL,
    created_at TIMESTAMP NULL,
    updated_at TIMESTAMP NULL,

    INDEX idx_tokenable (tokenable_type, tokenable_id),
    INDEX idx_token (token)
);
```

## 2. Endpoints de Autentica√ß√£o

Todos os endpoints est√£o sob o prefixo `/api/auth` e retornam JSON.

### 2.1 POST /api/auth/register

Cria um novo usu√°rio com credenciais pr√≥prias e retorna token Sanctum.

**Rate Limit:** 10 req/5min
**Middleware:** `throttle.custom:auth`

**Request:**
```json
{
  "name": "John Doe",
  "email": "john@example.com",
  "password": "StrongPass123!",
  "password_confirmation": "StrongPass123!"
}
```

**Valida√ß√£o:**
- `name`: required, string, max:255
- `email`: required, email, unique:users, max:255
- `password`: required, string, min:8, confirmed
  - Deve conter: 1 mai√∫scula, 1 min√∫scula, 1 n√∫mero, 1 caractere especial

**Response (201 Created):**
```json
{
  "success": true,
  "message": "User registered successfully",
  "data": {
    "user": {
      "id": 1,
      "name": "John Doe",
      "email": "john@example.com",
      "created_at": "2024-10-01T12:00:00.000000Z",
      "updated_at": "2024-10-01T12:00:00.000000Z"
    },
    "token": "1|abcdef123456789..."
  }
}
```

**Poss√≠veis Erros:**
- **409 Conflict** - Email j√° cadastrado
- **422 Unprocessable Entity** - Valida√ß√£o falhou
- **429 Too Many Requests** - Rate limit excedido

### 2.2 POST /api/auth/login

Autentica usu√°rio e emite token Sanctum para acesso √† API.

**Rate Limit:** 10 req/5min
**Middleware:** `throttle.custom:auth`

**Request:**
```json
{
  "email": "john@example.com",
  "password": "StrongPass123!",
  "remember": false
}
```

**Valida√ß√£o:**
- `email`: required, email
- `password`: required, string
- `remember`: optional, boolean

**Response (200 OK):**
```json
{
  "success": true,
  "message": "Login successful",
  "data": {
    "user": {
      "id": 1,
      "name": "John Doe",
      "email": "john@example.com",
      "created_at": "2024-10-01T12:00:00.000000Z",
      "updated_at": "2024-10-01T12:00:00.000000Z"
    },
    "token": "2|xyz789abc456...",
    "token_type": "Bearer"
  }
}
```

**Poss√≠veis Erros:**
- **401 Unauthorized** - Credenciais inv√°lidas
- **422 Unprocessable Entity** - Valida√ß√£o falhou
- **429 Too Many Requests** - Rate limit excedido

### 2.3 POST /api/auth/password/forgot

Envia email com c√≥digo de 6 d√≠gitos alfanum√©ricos para redefini√ß√£o de senha.

**Rate Limit:** 10 req/5min
**Middleware:** `throttle.custom:auth`

**Request:**
```json
{
  "email": "john@example.com"
}
```

**Valida√ß√£o:**
- `email`: required, email

**Response (200 OK):**
```json
{
  "success": true,
  "message": "Password reset code sent to your email"
}
```

**Comportamento de Seguran√ßa:**
- Sempre retorna **200 OK** mesmo para emails n√£o cadastrados (previne enumera√ß√£o)
- Token de **6 caracteres alfanum√©ricos** (A-Z, 2-9)
- Exclui caracteres amb√≠guos (0, O, 1, I)
- Token expira em **60 minutos**
- Apenas 1 token ativo por email (novos substituem antigos)
- **Case-insensitive** (ABC123 = abc123)

**Email Enviado:**
- Assunto: `Password Reset Code - PaintPro`
- Cont√©m c√≥digo de 6 d√≠gitos: `ABC123`
- Template: `emails.password-reset-code`
- Mailable: `App\Mail\PasswordResetMail`
- Remetente: configurado em `.env` (MAIL_FROM_ADDRESS)

**Exemplo de C√≥digo:**
```
Your code: ABC123
Expires in 60 minutes
```

**Poss√≠veis Erros:**
- **422 Unprocessable Entity** - Email inv√°lido
- **429 Too Many Requests** - Rate limit excedido
- **500 Internal Server Error** - Falha ao enviar email

### 2.4 POST /api/auth/password/reset

Redefine senha usando c√≥digo de 6 d√≠gitos recebido por email.

**Rate Limit:** 10 req/5min
**Middleware:** `throttle.custom:auth`

**Request:**
```json
{
  "email": "john@example.com",
  "token": "ABC123",
  "password": "NewStrongPass123!",
  "password_confirmation": "NewStrongPass123!"
}
```

**Valida√ß√£o:**
- `email`: required, email, exists:users
- `token`: required, string, 6 caracteres alfanum√©ricos (case-insensitive)
- `password`: required, string, min:8, confirmed
  - Deve conter: 1 mai√∫scula, 1 min√∫scula, 1 n√∫mero, 1 caractere especial

**Response (200 OK):**
```json
{
  "success": true,
  "message": "Password has been reset successfully"
}
```

**Poss√≠veis Erros:**
- **400 Bad Request** - Token inv√°lido ou expirado
  ```json
  {
    "success": false,
    "message": "Invalid or expired token",
    "errors": {
      "token": ["Invalid or expired token"]
    }
  }
  ```
- **422 Unprocessable Entity** - Valida√ß√£o falhou
- **429 Too Many Requests** - Rate limit excedido

**Observa√ß√µes:**
- Token √© **case-insensitive** (ABC123 = abc123)
- Token √© **deletado ap√≥s uso bem-sucedido** (one-time use)
- Tokens Sanctum existentes s√£o **revogados automaticamente** (for√ßa novo login)
- Token expira em **60 minutos**

## 3. Modelo User

**Arquivo:** `app/Modules/Shared/Models/User.php`

### Atributos Principais

```php
protected $fillable = [
    'name',
    'email',
    'password',
    'ghl_location_id',
    'ghl_business_id',
    'ghl_phone',
    'ghl_website',
    'ghl_address',
    'ghl_city',
    'ghl_state',
    'ghl_postal_code',
    'ghl_country',
    'ghl_description',
    'ghl_last_sync_at',
];

protected $hidden = [
    'password',
    'remember_token',
];

protected $casts = [
    'email_verified_at' => 'datetime',
    'ghl_last_sync_at' => 'datetime',
    'password' => 'hashed',
];
```

### Traits Utilizados
- `HasApiTokens` (Sanctum) - Gerenciamento de tokens API
- `HasFactory` - Factories para testes
- `Notifiable` - Sistema de notifica√ß√µes

### Relacionamentos
- `hasMany(GhlToken::class)` - Tokens GoHighLevel
- `hasMany(GhlContact::class)` - Contatos GHL
- `hasMany(Estimate::class)` - Or√ßamentos

### Campos GoHighLevel (Opcionais)

Os campos prefixados com `ghl_*` s√£o **opcionais** e podem ser preenchidos posteriormente via integra√ß√£o com GoHighLevel CRM. A autentica√ß√£o funciona **independentemente** desses campos.

Para gerenciar credenciais GHL:
- Veja: `docs/CONTATOS_MODULE.MD`
- Controller: `app/Modules/GoHighLevel/Controllers/GhlCredentialController.php`

## 4. Valida√ß√£o e Seguran√ßa

### 4.1 Requisitos de Senha

Implementados via Laravel validation rules:

```php
'password' => [
    'required',
    'string',
    'min:8',
    'confirmed',
    'regex:/[a-z]/',      // Pelo menos 1 min√∫scula
    'regex:/[A-Z]/',      // Pelo menos 1 mai√∫scula
    'regex:/[0-9]/',      // Pelo menos 1 n√∫mero
    'regex:/[@$!%*#?&]/', // Pelo menos 1 caractere especial
]
```

**Exemplos V√°lidos:**
- `MyPass123!`
- `SecureP@ssw0rd`
- `Str0ng#Passw0rd`

**Exemplos Inv√°lidos:**
- `password` (sem mai√∫scula, n√∫mero ou especial)
- `Pass123` (menos de 8 caracteres)
- `PASSWORD123!` (sem min√∫scula)

### 4.2 Sistema de Tokens de Reset (6 D√≠gitos)

**Servi√ßo:** `App\Modules\Auth\Services\PasswordResetTokenService`

**Caracter√≠sticas:**
- Token de **6 caracteres alfanum√©ricos** (A-Z, 2-9)
- Exclui caracteres amb√≠guos: 0 (zero), O (√≥), 1 (um), I (i)
- **Case-insensitive** para melhor UX
- Expira√ß√£o em **60 minutos**
- **One-time use** (deletado ap√≥s uso bem-sucedido)
- Substitui tokens antigos do mesmo email
- Valida√ß√£o com verifica√ß√£o de expira√ß√£o

**Exemplo de Token:**
```
ABC123
XYZ789
PQ4T5N
```

**Seguran√ßa:**
- Espa√ßo de busca: 32^6 ‚âà **1 bilh√£o de combina√ß√µes**
- Expira√ß√£o r√°pida (60 min)
- Rate limiting (10 req/5min)
- One-time use
- Preven√ß√£o de enumera√ß√£o de emails

**Implementa√ß√£o:**
```php
// Criar token
$token = $tokenService->create($email); // "ABC123"

// Verificar token
$isValid = $tokenService->verify($email, $token); // true/false

// Deletar token
$tokenService->delete($email);

// Limpar expirados
$deleted = $tokenService->deleteExpired();
```

### 4.3 Rate Limiting

Configura√ß√£o: `config/rate-limiting.php`

```php
'auth' => [
    'max_attempts' => 10,
    'decay_minutes' => 5,
]
```

**Resposta quando limite excedido:**
```json
{
  "success": false,
  "message": "Too many requests. Please slow down.",
  "error_code": "RATE_LIMIT_EXCEEDED",
  "details": {
    "max_attempts": 10,
    "decay_minutes": 5,
    "retry_after_seconds": 243
  }
}
```

### 4.4 Tokens Sanctum

**Caracter√≠sticas:**
- Stateless (n√£o requerem sess√µes)
- Armazenados em `personal_access_tokens`
- Hash SHA-256 para seguran√ßa
- N√£o expiram por padr√£o (configur√°vel)
- Podem ter habilidades (abilities) espec√≠ficas

**Uso:**
```http
Authorization: Bearer {token}
```

**Configura√ß√£o de Expira√ß√£o (opcional):**
```php
// config/sanctum.php
'expiration' => 525600, // minutos (1 ano)
```

### 4.5 Prote√ß√£o CSRF

**APIs:**
- CSRF **desabilitado** para rotas `/api/*` (stateless)
- Autentica√ß√£o via Bearer token apenas

**Web:**
- CSRF **habilitado** para rotas web
- Token CSRF em meta tag

### 4.6 Headers de Seguran√ßa

Configurados automaticamente:
- `X-Frame-Options: SAMEORIGIN`
- `X-Content-Type-Options: nosniff`
- `X-XSS-Protection: 1; mode=block`

## 5. Fluxos Completos

### 5.1 Fluxo de Registro

```mermaid
sequenceDiagram
    Client->>API: POST /api/auth/register
    API->>Validator: Valida dados
    Validator-->>API: Valida√ß√£o OK
    API->>Database: Cria usu√°rio
    Database-->>API: Usu√°rio criado
    API->>Sanctum: Gera token
    Sanctum-->>API: Token gerado
    API-->>Client: 201 + user + token
```

### 5.2 Fluxo de Login

```mermaid
sequenceDiagram
    Client->>API: POST /api/auth/login
    API->>Validator: Valida formato
    API->>Auth: Verifica credenciais
    Auth-->>API: Credenciais v√°lidas
    API->>Sanctum: Gera token
    Sanctum-->>API: Token gerado
    API-->>Client: 200 + user + token
```

### 5.3 Fluxo de Recupera√ß√£o de Senha (6-Digit Code)

```mermaid
sequenceDiagram
    Client->>API: POST /api/auth/password/forgot
    API->>Database: Busca usu√°rio por email
    Database-->>API: Usu√°rio encontrado
    API->>TokenService: Gera c√≥digo 6 d√≠gitos
    TokenService-->>API: ABC123
    API->>Database: Armazena token
    Database-->>API: Token armazenado
    API->>Mail: Envia email com c√≥digo
    Mail-->>User: Email com c√≥digo ABC123
    User->>Client: Digite c√≥digo no app
    Client->>API: POST /api/auth/password/reset {token: "ABC123"}
    API->>TokenService: Verifica token + expira√ß√£o
    TokenService-->>API: Token v√°lido
    API->>Database: Atualiza senha + revoga tokens
    Database-->>API: Senha atualizada
    API->>TokenService: Deleta token usado
    TokenService-->>API: Token deletado
    API-->>Client: 200 Success
```

## 6. Uso em Testes

### 6.1 Factories

```php
use App\Modules\Shared\Models\User;

// Factory b√°sica
$user = User::factory()->create();

// Com dados espec√≠ficos
$user = User::factory()->create([
    'email' => 'test@example.com',
    'password' => bcrypt('password123'),
]);

// M√∫ltiplos usu√°rios
$users = User::factory()->count(10)->create();
```

### 6.2 Testes de Autentica√ß√£o

```php
use App\Modules\Shared\Models\User;

public function test_user_can_login()
{
    $user = User::factory()->create([
        'email' => 'test@example.com',
        'password' => bcrypt('Password123!'),
    ]);

    $response = $this->postJson('/api/auth/login', [
        'email' => 'test@example.com',
        'password' => 'Password123!',
    ]);

    $response->assertStatus(200)
        ->assertJsonStructure([
            'success',
            'message',
            'data' => ['user', 'token', 'token_type'],
        ]);
}
```

### 6.3 Usando Token em Testes

```php
// Com Sanctum actingAs
$user = User::factory()->create();

$this->actingAs($user)
    ->getJson('/api/user')
    ->assertStatus(200);

// Com token real
$response = $this->postJson('/api/auth/login', [
    'email' => $user->email,
    'password' => 'password',
]);

$token = $response->json('data.token');

$this->withHeader('Authorization', 'Bearer ' . $token)
    ->getJson('/api/estimates')
    ->assertStatus(200);
```

## 7. Middleware Stack

### 7.1 Rotas de Autentica√ß√£o

```php
Route::prefix('auth')
    ->middleware(['throttle.custom:auth'])
    ->group(function () {
        Route::post('/login', [CredentialsAuthController::class, 'login']);
        Route::post('/register', [CredentialsAuthController::class, 'register']);
        Route::post('/password/forgot', [CredentialsAuthController::class, 'forgotPassword']);
        Route::post('/password/reset', [CredentialsAuthController::class, 'resetPassword']);
    });
```

### 7.2 Rotas Protegidas

```php
Route::middleware(['auth:sanctum', 'user.ownership'])
    ->get('/user', function (Request $request) {
        return $request->user();
    });
```

**Middleware aplicado:**
- `auth:sanctum` - Autentica√ß√£o via Sanctum
- `user.ownership` - Garante que usu√°rio acessa apenas seus dados
- `throttle.custom:*` - Rate limiting customizado

## 8. Comandos √öteis

### 8.1 Artisan Commands

```bash
# Limpar tokens expirados (se configurado expiration)
php artisan sanctum:prune-expired

# Criar usu√°rio via tinker
php artisan tinker
>>> User::create([
    'name' => 'Test User',
    'email' => 'test@example.com',
    'password' => bcrypt('Password123!')
]);

# Listar todos os tokens
>>> \Laravel\Sanctum\PersonalAccessToken::all();

# Revogar todos os tokens de um usu√°rio
>>> User::find(1)->tokens()->delete();
```

### 8.2 Database Commands

```bash
# Rodar migrations
php artisan migrate

# Resetar banco e reexecutar migrations
php artisan migrate:fresh

# Com seeders
php artisan migrate:fresh --seed
```

## 9. Configura√ß√£o do Ambiente

### 9.1 Vari√°veis Obrigat√≥rias (.env)

```env
APP_KEY=base64:...
APP_URL=http://localhost:8080

# Database
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=paint_pro_db
DB_USERNAME=paint_pro_user
DB_PASSWORD=paint_pro_password

# Mail (para recupera√ß√£o de senha)
MAIL_MAILER=smtp
MAIL_HOST=smtp.mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=your_username
MAIL_PASSWORD=your_password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@paintpro.com
MAIL_FROM_NAME="${APP_NAME}"

# Sanctum
SANCTUM_STATEFUL_DOMAINS=localhost,127.0.0.1
SESSION_DRIVER=cookie
```

### 9.2 Configura√ß√£o de Mail (Desenvolvimento)

**Op√ß√£o 1: Mailtrap**
```env
MAIL_MAILER=smtp
MAIL_HOST=smtp.mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=your_mailtrap_username
MAIL_PASSWORD=your_mailtrap_password
```

**Op√ß√£o 2: Log (apenas para testes)**
```env
MAIL_MAILER=log
```

**Op√ß√£o 3: Mailhog (Docker)**
```env
MAIL_MAILER=smtp
MAIL_HOST=mailhog
MAIL_PORT=1025
MAIL_ENCRYPTION=null
```

## 10. Troubleshooting

### 10.1 Problema: Token n√£o funciona

**Sintomas:**
```json
{
  "message": "Unauthenticated."
}
```

**Solu√ß√µes:**
1. Verifique o header: `Authorization: Bearer {token}`
2. Confirme que o token n√£o foi revogado
3. Verifique se o usu√°rio n√£o foi deletado
4. Limpe cache: `php artisan config:clear`

### 10.2 Problema: Rate limit atingido

**Sintomas:**
```json
{
  "message": "Too many requests. Please slow down.",
  "error_code": "RATE_LIMIT_EXCEEDED"
}
```

**Solu√ß√µes:**
1. Espere o tempo indicado em `retry_after_seconds`
2. Use IPs diferentes em testes
3. Ajuste configura√ß√£o em `config/rate-limiting.php`
4. Desabilite rate limit em testes: `$this->withoutMiddleware()`

### 10.3 Problema: Email n√£o chega

**Solu√ß√µes:**
1. Verifique configura√ß√£o de email em `.env`
2. Confira logs em `storage/logs/laravel.log`
3. Teste conex√£o SMTP: `php artisan tinker` ‚Üí `Mail::raw('test', fn($m) => $m->to('test@test.com')->subject('test'));`
4. Use Mailtrap/Mailhog em desenvolvimento
5. Verifique fila se usando `queue`: `php artisan queue:work`

### 10.4 Problema: Senha n√£o atende requisitos

**Sintomas:**
```json
{
  "success": false,
  "errors": {
    "password": [
      "The password format is invalid."
    ]
  }
}
```

**Solu√ß√£o:**
Senha deve ter:
- M√≠nimo 8 caracteres
- Pelo menos 1 letra mai√∫scula
- Pelo menos 1 letra min√∫scula
- Pelo menos 1 n√∫mero
- Pelo menos 1 caractere especial (@$!%*#?&)

### 10.5 Problema: Migration falha

**Sintomas:**
```
SQLSTATE[42P07]: Duplicate table: 7 ERROR:  relation "users" already exists
```

**Solu√ß√µes:**
1. Dropar todas as tabelas: `php artisan migrate:fresh`
2. Ou rodar apenas novas migrations: `php artisan migrate`
3. Verificar se migration j√° foi rodada: `php artisan migrate:status`

## 11. Boas Pr√°ticas

### 11.1 Seguran√ßa

‚úÖ **Fa√ßa:**
- Sempre use HTTPS em produ√ß√£o
- Configure expira√ß√£o de tokens Sanctum
- Implemente 2FA para opera√ß√µes sens√≠veis
- Use `bcrypt` ou `Hash::make()` para senhas
- Valide entrada do usu√°rio com FormRequests
- Log tentativas de login falhadas

‚ùå **N√£o fa√ßa:**
- Armazenar senhas em plain text
- Retornar senha em respostas JSON
- Desabilitar rate limiting em produ√ß√£o
- Usar tokens Sanctum em URLs (query params)
- Expor informa√ß√µes sens√≠veis em logs

### 11.2 Performance

‚úÖ **Fa√ßa:**
- Use eager loading para relacionamentos
- Cache queries frequentes
- Use √≠ndices em colunas de busca (email)
- Pagine listagens grandes
- Use Redis para sessions em produ√ß√£o

‚ùå **N√£o fa√ßa:**
- N+1 queries (use `with()`)
- Carregar todos os usu√°rios de uma vez
- Fazer queries no loop
- Armazenar sessions em banco sem √≠ndice

### 11.3 Testes

‚úÖ **Fa√ßa:**
- Testar todos os endpoints de auth
- Testar valida√ß√µes
- Testar rate limiting
- Usar factories para dados de teste
- Limpar dados ap√≥s testes (RefreshDatabase)

‚ùå **N√£o fa√ßa:**
- Usar dados de produ√ß√£o em testes
- Pular testes de valida√ß√£o
- Hard-code valores sens√≠veis
- Depender de ordem de execu√ß√£o

## 12. Changelog

### v1.1.0 (2024-10-01) - Token de 6 D√≠gitos
- ‚úÖ **Sistema de tokens de reset customizado**
  - Token de 6 caracteres alfanum√©ricos (A-Z, 2-9)
  - Case-insensitive para melhor UX
  - Exclui caracteres amb√≠guos (0, O, 1, I)
  - Expira√ß√£o em 60 minutos
  - One-time use (auto-delete ap√≥s uso)
- ‚úÖ **Novo servi√ßo:** `PasswordResetTokenService`
- ‚úÖ **Mailable customizado:** `PasswordResetMail`
- ‚úÖ **Template HTML profissional** para email
- ‚úÖ **Revoga√ß√£o autom√°tica de tokens Sanctum** ap√≥s reset
- ‚úÖ **14 novos testes** (12 unit + 2 feature)
- ‚úÖ **Documenta√ß√£o atualizada** com fluxos e exemplos

### v1.0.0 (2024-09-29)
- ‚úÖ Implementa√ß√£o inicial com credenciais
- ‚úÖ Endpoints: register, login, forgot password, reset password
- ‚úÖ Integra√ß√£o Sanctum
- ‚úÖ Rate limiting customizado
- ‚úÖ Valida√ß√£o de senha forte
- ‚úÖ Suporte a campos opcionais GHL
- ‚úÖ Remo√ß√£o completa do fluxo OAuth

### Melhorias Futuras
- [ ] Verifica√ß√£o de email (email verification)
- [ ] 2FA (Two-Factor Authentication)
- [ ] Social login (Google, Apple)
- [ ] Refresh token support
- [ ] Device management (listar/revogar dispositivos)
- [ ] Login history tracking
- [ ] Scheduled task para limpar tokens expirados
